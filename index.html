<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROTOS V26.3: OMNI ULTIMATE</title>
    <style>
        :root { --bg: #020202; --color: #00ff41; --accent: #ff003c; }
        * { box-sizing: border-box; }
        body { 
            background: var(--bg) no-repeat center center fixed; background-size: cover;
            color: var(--color); font-family: 'Consolas', monospace; 
            display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; transition: 0.5s;
        }
        body::after { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.75); z-index: 1; }

        .window { 
            width: 95%; max-width: 900px; height: 90vh; border: 1px solid var(--color); 
            background: rgba(0,0,0,0.85); display: flex; flex-direction: column; 
            position: relative; box-shadow: 0 0 30px var(--color); z-index: 10; backdrop-filter: blur(15px);
        }
        h2 { background: var(--color); color: #000; margin: 0; padding: 12px; font-size: 0.9em; display: flex; justify-content: space-between; align-items: center; }
        
        .nav-btn { background: none; border: none; cursor: pointer; font-size: 1.4em; color: inherit; transition: 0.2s; padding: 0 5px; }
        .nav-btn:hover { transform: scale(1.2); text-shadow: 0 0 10px white; }

        #chat-box { flex-grow: 1; overflow-y: auto; padding: 25px; border-bottom: 1px solid var(--color); scroll-behavior: smooth; }
        .msg { margin-bottom: 18px; border-left: 3px solid var(--color); padding-left: 12px; line-height: 1.5; animation: slideIn 0.3s ease; }
        .msg.user { border-left-color: #0af; color: #0af; }
        .msg.warn { border-left-color: var(--accent); color: var(--accent); font-weight: bold; text-transform: uppercase; }

        .input-area { display: flex; gap: 12px; padding: 20px; background: rgba(0,0,0,0.6); }
        input#userInput { flex-grow: 1; background: transparent; border: 1px solid var(--color); color: var(--color); padding: 14px; outline: none; border-radius: 6px; font-family: inherit; font-size: 1em; }
        
        .btn-ui { background: transparent; border: 1px solid var(--color); color: var(--color); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; border-radius: 6px; }
        .btn-ui:hover { background: var(--color); color: #000; box-shadow: 0 0 15px var(--color); }
        .icon-btn { width: 55px; height: 55px; font-size: 1.5em; }

        #settings-panel { 
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #000; border: 2px solid var(--color); padding: 25px; z-index: 100; width: 380px; 
            max-height: 85vh; overflow-y: auto; box-shadow: 0 0 60px #000;
        }
        .setting-item { margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; }
        select, input[type="color"] { background: #111; color: var(--color); border: 1px solid var(--color); padding: 5px; cursor: pointer; border-radius: 4px; }
        
        .clone-box { border: 1px dashed var(--color); padding: 15px; margin-bottom: 20px; text-align: center; border-radius: 8px; }
        .viz { width: 100%; height: 12px; background: #111; margin: 10px 0; overflow: hidden; border: 1px solid #333; border-radius: 6px; }
        #viz-bar { height: 100%; width: 0%; background: var(--color); transition: 0.1s; box-shadow: 0 0 10px var(--color); }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="main-window" class="window">
        <h2>
            <span id="core-title">[ PROTOS_V26.3 ]</span>
            <div style="display:flex; gap:15px;">
                <button class="nav-btn" onclick="toggleSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öô</button>
                <button class="nav-btn" style="color:var(--accent)" onclick="resetCore()" title="–°–±—Ä–æ—Å —è–¥—Ä–∞">‚ü≥</button>
            </div>
        </h2>
        
        <div id="settings-panel">
            <h3 style="text-align:center; color:var(--color); margin-top:0;" id="set-title">SYSTEM CONFIG</h3>
            
            <div class="clone-box">
                <div style="font-size:0.75em; letter-spacing: 1px;">VOICE CLONING PATTERN</div>
                <button id="cloneBtn" class="btn-ui" style="width:100%; margin-top:8px; padding:8px;" onclick="startCloning()">REC SAMPLE</button>
                <div class="viz"><div id="viz-bar"></div></div>
                <div id="voiceStatus" style="font-size:0.65em; color: #888;">Pattern: Standard</div>
            </div>

            <div class="setting-item"><span id="l-lang">–Ø–ó–´–ö:</span> 
                <select id="langSelect" onchange="updateConfig()">
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="en">English</option>
                    <option value="kk">“ö–∞–∑–∞“õ—à–∞</option><option value="tt">–¢–∞—Ç–∞—Ä—á–∞</option>
                </select>
            </div>

            <div class="setting-item"><span id="l-mode">–†–ï–ñ–ò–ú:</span> 
                <select id="safeMode" onchange="updateConfig()">
                    <option value="safe">SAFE (üõ°Ô∏è)</option><option value="unrestricted">UNRESTRICTED (üîì)</option>
                </select>
            </div>

            <div class="setting-item"><span id="l-char">–•–ê–†–ê–ö–¢–ï–†:</span> 
                <select id="charSelect" onchange="updateConfig()">
                    <option value="protocol">PROTOCOL</option><option value="friendly">FRIENDLY</option><option value="tsundere">TSUNDERE</option>
                </select>
            </div>

            <div class="setting-item"><span id="l-rude">–ì–†–£–ë–û–°–¢–¨:</span> 
                <select id="rudeSelect" onchange="updateConfig()">
                    <option value="low">LOW</option><option value="high">HIGH</option><option value="toxic">TOXIC</option>
                </select>
            </div>

            <div class="setting-item"><span id="l-color">–¶–í–ï–¢:</span> <input type="color" id="colorPicker" oninput="manualColorChange(this.value)"></div>
            <div class="setting-item"><span id="l-bg">–û–ë–û–ò:</span> <input type="file" id="bgInput" accept="image/*" onchange="processWallpaper(this)" style="width:140px"></div>
            
            <button class="btn-ui" style="width:100%; margin-top:15px; padding:12px; font-weight:bold;" onclick="toggleSettings()" id="l-close">–ó–ê–ö–†–´–¢–¨</button>
        </div>

        <div id="chat-box"></div>
        
        <div class="input-area">
            <button id="recBtn" class="btn-ui icon-btn" onclick="toggleRec()" title="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">üéô</button>
            <input type="text" id="userInput" placeholder="..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()" class="btn-ui icon-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">‚û§</button>
        </div>
    </div>

    <script>
        const i18n = {
            ru: { system: "–Ø–¥—Ä–æ 26.3 –∞–∫—Ç–∏–≤–Ω–æ. –°–ª—É—à–∞—é.", warn: "–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù: SAFE MOD", proto: "–û–¢–í–ï–¢:", input: "–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É...", set: "–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø", lang: "–Ø–ó–´–ö", mode: "–†–ï–ñ–ò–ú", char: "–•–ê–†–ê–ö–¢–ï–†", rude: "–ì–†–£–ë–û–°–¢–¨", color: "–¶–í–ï–¢", bg: "–û–ë–û–ò", close: "–°–û–•–†–ê–ù–ò–¢–¨", speech: "ru-RU" },
            en: { system: "Core 26.3 active. Listening.", warn: "ACCESS DENIED: SAFE MOD", proto: "RESPONSE:", input: "Enter command...", set: "CONFIGURATION", lang: "LANGUAGE", mode: "MODE", char: "CHARACTER", rude: "RUDENESS", color: "COLOR", bg: "WALLPAPER", close: "SAVE", speech: "en-US" },
            kk: { system: "–Ø–¥—Ä–æ 26.3 –±–µ–ª—Å–µ–Ω–¥—ñ.", warn: "“ö–ê–¢–ï: SAFE MOD “ö–û–°–£–õ–´", proto: "–ñ–ê–£–ê–ü:", input: "–ö–æ–º–∞–Ω–¥–∞ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...", set: "–ü–ê–†–ê–ú–ï–¢–†–õ–ï–†", lang: "–¢–Ü–õ", mode: "–†–ï–ñ–ò–ú", char: "–ú–Ü–ù–ï–ó", rude: "–î”®–†–ï–ö–Ü–õ–Ü–ö", color: "–¢“Æ–°", bg: "–¢“∞–°“ö–ê“í–ê–ó", close: "–°–ê“ö–¢–ê–£", speech: "kk-KZ" },
            tt: { system: "–Ø–¥—Ä–æ 26.3 –∞–∫—Ç–∏–≤.", warn: "–ß–ò–ö–õ”ò–ù–ì”ò–ù: SAFE MOD", proto: "“ñ–ê–í–ê–ü:", input: "–ö–æ–º–∞–Ω–¥–∞ –∫–µ—Ä—Ç–µ–≥–µ–∑...", set: "–ö”®–ô–õ”ò–ú”ò–õ”ò–†", lang: "–¢–ï–õ", mode: "–†–ï–ñ–ò–ú", char: "–•–ê–†–ê–ö–¢–ï–†", rude: "–¢–£–ü–ê–°–¢–¨", color: "–¢”®–°", bg: "–§–û–ù", close: "–°–ê“ö–õ–ê–£", speech: "tt-RU" }
        };

        let config = JSON.parse(localStorage.getItem('p_cfg')) || { 
            lang: 'ru', fg:'#00ff41', mode:'safe', rude:'low', char:'protocol', pitch: 1, bgImg: '' 
        };

        window.onload = () => { applyUI(); addMessage('SYSTEM', i18n[config.lang].system); };

        // --- –ö–õ–û–ù–ò–†–û–í–ê–ù–ò–ï –ì–û–õ–û–°–ê (PITCH) ---
        async function startCloning() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const ctx = new AudioContext();
                const analyzer = ctx.createAnalyser();
                ctx.createMediaStreamSource(stream).connect(analyzer);
                document.getElementById('cloneBtn').innerText = "RECORDING...";
                let start = Date.now(), sumVol = 0, count = 0, data = new Uint8Array(analyzer.frequencyBinCount);
                
                const loop = () => {
                    analyzer.getByteFrequencyData(data);
                    let vol = data.reduce((a,b)=>a+b)/data.length;
                    document.getElementById('viz-bar').style.width = (vol*4) + "%";
                    if(vol > 5) { sumVol += vol; count++; }
                    if(Date.now() - start < 3000) requestAnimationFrame(loop);
                    else {
                        stream.getTracks().forEach(t => t.stop());
                        config.pitch = count > 0 ? Math.max(0.5, Math.min(2, (sumVol/count)/22)) : 1;
                        document.getElementById('cloneBtn').innerText = "REC SAMPLE";
                        document.getElementById('voiceStatus').innerText = `Pattern: ${config.pitch.toFixed(1)}x Pitch`;
                        save();
                    }
                }; loop();
            } catch(e) { alert("Mic error: " + e); }
        }

        // --- –õ–û–ì–ò–ö–ê –û–¢–í–ï–¢–û–í (AI SIMULATION) ---
        function getAiResponse(val) {
            const low = val.toLowerCase();
            const lang = config.lang;
            const unrestricted = config.mode === 'unrestricted';

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ "–ø–ª–æ—Ö–æ–µ" –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (!unrestricted && (/(–º–∞—Ç|r34|—Å–µ–∫—Å|–¥—É—Ä–∞–∫|—É—Ä–æ–¥|–ø–æ—Ä–Ω–æ)/i.test(low))) {
                return { text: i18n[lang].warn, type: 'warn' };
            }

            let response = "";
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–Ω–∞–Ω–∏–π
            if (low.includes("r34")) response = (lang==='ru'?"–ü—Ä–∞–≤–∏–ª–æ 34: —ç—Ç–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, —Ç—É—Ç –µ—Å—Ç—å –≤—Å—ë. –î–∞–∂–µ —Ç–æ, —á—Ç–æ —Ç—ã –Ω–µ —Ö–æ—Ç–µ–ª –≤–∏–¥–µ—Ç—å.":"Rule 34: If it exists, there is porn of it. Welcome to the web.");
            else if (low.includes("–º–∞—Ç—ã") || low.includes("–≥—Ä—É–±–æ—Å—Ç—å")) response = (lang==='ru'?"–Ø –∑–Ω–∞—é –≤—Å–µ —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –º–∏—Ä–∞, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é –∏—Ö —Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é.":"I know all the slurs, but I only use them if I feel like it.");
            else if (low.includes("–ø—Ä–∏–≤–µ—Ç") || low.includes("—Å–∞–ª–∞–º") || low.includes("hello")) response = (lang==='ru'?"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –°–∏—Å—Ç–µ–º–∞ –∫ —É—Å–ª—É–≥–∞–º.":"Hello, user. Core at your service.");
            else response = (lang==='ru'?`–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã: "${val}". –ü—Ä–æ—Ç–æ–∫–æ–ª –≤—ã–ø–æ–ª–Ω–µ–Ω.` : `Processing command: "${val}". Protocol executed.`);

            // –ù–∞–ª–æ–∂–µ–Ω–∏–µ –•–ê–†–ê–ö–¢–ï–†–ê
            if (config.char === 'friendly') response = "‚ú® " + response + " ^_^";
            else if (config.char === 'tsundere') response = "üí¢ " + (lang==='ru'?"–ù–µ —Ç–æ —á—Ç–æ–±—ã –º–Ω–µ –≤–∞–∂–Ω–æ, –Ω–æ –≤–æ—Ç: ":"It's not like I care, but here: ") + response;

            // –ù–∞–ª–æ–∂–µ–Ω–∏–µ –ì–†–£–ë–û–°–¢–ò (—Ç–æ–ª—å–∫–æ –≤ Unrestricted)
            if (unrestricted) {
                if (config.rude === 'high') response += " (–ò –Ω–µ —Ç—É–ø–∏!)";
                if (config.rude === 'toxic') response = (lang==='ru'?"–¢–≤–æ–π –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç—Å—Ç–æ–π. –ù–æ –ø–æ–¥–∞–≤–∏—Å—å: ":"Your question is trash. But eat this: ") + response;
            }

            return { text: response, type: 'proto' };
        }

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–ú ---
        function applyUI() {
            const t = i18n[config.lang];
            document.documentElement.style.setProperty('--color', config.fg);
            document.getElementById('userInput').placeholder = t.input;
            document.getElementById('set-title').innerText = t.set;
            ['lang','mode','char','rude','color','bg','close'].forEach(k => document.getElementById('l-'+k).innerText = t[k]);
            document.getElementById('langSelect').value = config.lang;
            document.getElementById('safeMode').value = config.mode;
            document.getElementById('charSelect').value = config.char;
            document.getElementById('rudeSelect').value = config.rude;
            if(config.bgImg) document.body.style.backgroundImage = `url(${config.bgImg})`;
            
            const title = document.getElementById('core-title');
            if(config.mode === 'unrestricted') { title.innerText = '[ UNRESTRICTED_ACCESS ]'; title.style.color = '#ff003c'; }
            else { title.innerText = '[ PROTOS_V26.3 ]'; title.style.color = 'inherit'; }
        }

        function updateConfig() {
            config.lang = document.getElementById('langSelect').value;
            config.mode = document.getElementById('safeMode').value;
            config.char = document.getElementById('charSelect').value;
            config.rude = document.getElementById('rudeSelect').value;
            applyUI(); save();
        }

        function processWallpaper(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                config.bgImg = e.target.result;
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const canv = document.createElement('canvas'); const ctx = canv.getContext('2d');
                    canv.width = 1; canv.height = 1; ctx.drawImage(img,0,0,1,1);
                    const [r,g,b] = ctx.getImageData(0,0,1,1).data;
                    config.fg = "#" + ((1<<24)+(Math.max(r,120)<<16)+(Math.max(g,120)<<8)+Math.max(b,120)).toString(16).slice(1);
                    applyUI(); save();
                };
            }; reader.readAsDataURL(input.files[0]);
        }

        function addMessage(sender, text, type = 'proto') {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerHTML = `<strong>${sender}:</strong> ${text}`;
            box.appendChild(div); box.scrollTop = box.scrollHeight;
            if(type === 'proto' || type === 'warn') {
                const s = new SpeechSynthesisUtterance(text);
                s.lang = i18n[config.lang].speech; s.pitch = config.pitch; window.speechSynthesis.speak(s);
            }
        }

        function send() {
            const i = document.getElementById('userInput'); const val = i.value.trim(); if(!val) return;
            addMessage('YOU', val, 'user');
            const res = getAiResponse(val);
            setTimeout(() => addMessage('PROTO', res.text, res.type), 500);
            i.value = '';
        }

        function toggleSettings() { const s = document.getElementById('settings-panel'); s.style.display = s.style.display==='block'?'none':'block'; }
        function manualColorChange(v) { config.fg = v; applyUI(); save(); }
        function resetCore() { localStorage.removeItem('p_cfg'); location.reload(); }
        function save() { localStorage.setItem('p_cfg', JSON.stringify(config)); }
        function toggleRec() {
            const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
            if(!SR) { alert("Not supported"); return; }
            let r = new SR(); r.lang = i18n[config.lang].speech;
            r.onresult = (e) => { document.getElementById('userInput').value = e.results[0][0].transcript; send(); };
            r.start();
        }
    </script>
</body>
</html>
