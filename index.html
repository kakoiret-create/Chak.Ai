        const i18n = {
            ru: { system: "Система готова.", warn: "ОГРАНИЧЕНО", proto: "Ответ:", input: "Команда...", set: "НАСТРОЙКИ", lang: "ЯЗЫК", mode: "РЕЖИМ", color: "ЦВЕТ", bg: "ОБОИ", close: "ЗАКРЫТЬ", speech: "ru-RU" },
            en: { system: "System online.", warn: "RESTRICTED", proto: "Response:", input: "Command...", set: "SETTINGS", lang: "LANGUAGE", mode: "MODE", color: "COLOR", bg: "WALLPAPER", close: "CLOSE", speech: "en-US" }
        };

        let config = JSON.parse(localStorage.getItem('p_cfg')) || { 
            lang: 'ru', fg:'#00ff41', mode:'safe', pitch: 1, bgImg: '' 
        };

        window.onload = () => { 
            applyUI(); 
            addMessage('SYSTEM', i18n[config.lang].system); 
        };

        function addMessage(sender, text) {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg ${sender.toLowerCase() === 'user' ? 'user' : ''}`;
            div.innerHTML = `[${sender}] ${text}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // ГЛАВНОЕ: Убираем зеркалирование здесь
        function send() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if(!text) return;

            addMessage('USER', text);
            input.value = '';

            const lowText = text.toLowerCase();
            let reply = "";

            // Логика ответов
            if(lowText.includes("привет")) reply = "Ядро PROTOS приветствует тебя.";
            else if(lowText.includes("как дела")) reply = "Все системы в норме. Нагрузка на ЦП 2%.";
            else if(lowText.includes("время")) reply = new Date().toLocaleTimeString();
            else if(lowText.includes("кто ты")) reply = "Я — терминал управления PROTOS V26.3.";
            else reply = "Запрос не распознан. Требуется уточнение.";

            setTimeout(() => {
                addMessage('PROTO', reply);
                speak(reply);
            }, 500);
        }

        function speak(text) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = i18n[config.lang].speech;
            msg.pitch = config.pitch;
            window.speechSynthesis.speak(msg);
        }

        function applyUI() {
            document.documentElement.style.setProperty('--color', config.fg);
            if(config.bgImg) document.body.style.backgroundImage = `url(${config.bgImg})`;
        }

        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }

        function manualColorChange(val) {
            config.fg = val;
            applyUI();
            localStorage.setItem('p_cfg', JSON.stringify(config));
        }

        function resetCore() {
            localStorage.removeItem('p_cfg');
            location.reload();
        }
